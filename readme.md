# Domoos Project

Продакшн Domoos.ru работает на PHP, текущий dev проект лишь имитирует его структуру.  
Условно dev проект можно поделить на 2 части:

### Оглавление

- [Cтатическая](#Cтатическая)
- [Асинхронная](#Асинхронная)
- [Работа со сборкой](#Работа-со-сборкой)
- [Git hooks](#Git-hooks)
- [Must Have](#Must-Have)
- [Полезные ссылки](#Полезные-ссылки)
- [Остальные фичи](#Остальные-фичи)
- [Работа с формами](#Работа-с-формами)
- [TODO](#TODO)

### Cтатическая

Gulp, Wepack, Pug, Stylus + Rupture, jQuery (файл App.js). HTML структура проекта сгенерированна Pug шаблонизатором. Каждая страница состоит из блоков, расположеных в /blocks. Блоки состоят из Pug файлов и миксинов расположенных в /blocks/mixins.pug. Миксины используются для часто повторяющихся HTML элементов: дропадауны, слайдеры, акардионы и формы обратной связи. Стили некоторых блоков, например header, меняются в зависимости от страницы на которой они находяться.

Фрейморк для создания стилей - Stylus. Глобальные стили храняться в /styles, остальные разложены рядом с компонентами, к которым они пренадлежат. Стили написаны в формате SCSS для упрощенного перехода на Styled Components в будущем. Используются CSS3 переменные. Подход к адаптивке - мобайл фёрст. При описании адаптивки распологать брейкпойнты от меньшего к большему сверху в низ. Файлы стилей делятся на: базовые (0 - миксины, 1 - переменные, 2 - css сброс, 3 - шрифты, 4 - базовые стилизованные элементы, 5 - повторяющиеся css-конструкции), /vendors - стили сторонних библиотек. Точки входа стилей: /styles/app.styl - стили статики, /scripts/react.styl - стили react компонентов.

### Асинхронная

React + Redux, Redux Actions, Axios + не Rest (!), ES6. На этом уровене загружаются React компоненты c асинхронной подгрузкой данных, затем они рендеряться в статику по определенным айдишникам, если те существуют. В некоторых компонентах встречаются PropTypes. Точка входа для всех реaкт-компонентов /scripts/react.js

API проекта распологается на сабдомене, для работы с ним используется proxy-middleware, которая настраивается в конфиге локального сервера /gulp/server.js.

В проекте созданы глобальные переменные окружения Dev/Production
На выходе получаем папку /dist, в которой зраниться сгенерированный html + статика разбитая по папкам.

# Работа со сборкой

Для работы с проектом должна быть установлена Node.js.  
Если Node.js стоит, устанавливаем модули использующиеся в проекте:

```
npm i
```

Запустить локальный сервер для разарботки:

```
npm start
```

Создать production сборку, затем поместить ее в архив, который будет лежать в корне:

```
npm run production
```

Заархивировать текущую сборку в архив:

```
npm run zip
```

# Git hooks

Используется husky. Перед каждым git push запускается линтер. Если линтер падает с ошибкой, git push не пройдет. Пропустить линтинг можно, используя git push --no-verify

[исключен из зависимостей, но можно добавить и все заработает]

# Must Have

Работать с проектом рекомендуется в Visual Studio Code, у становленными плагинами: Prettier, Editor Config, ES Lint, Language Stylus, Manta's Stylus Supremacy. Эти плагины активируют конфиги в корне проекта, которые отвечают за автоформатирование JS / CSS, что позволяет соблюдать определенный style-код для всех разработчиков во всех файлах проекта.

[Если автоформатирование не работает, возможно надо прописать в конфиге VS Code активацию автоформатированию по ctrl + s]

# Полезные ссылки

`https://trello.com/b/CrDducH5/domoos` - Доска с задачами по проекту.  
`https://github.com/CSSSR/csssr-project-template` - Сам проект сделан на основе фронтенд сборки CSSSR, c ее более подробным описанием можно ознакомиться по ссылке выше.  
`https://dev.domoos.ru` - Дев сервер для тестирования продакшн сборки  
`https://api.domoos.ru` - АПИ для доступа к базе

# Остальные фичи

Для скриптов настроен Babel с пресетами es2015 и react  
SVG спрайты - минимимизируем количество запросов к серверу  
Дропдауны, табы, аккардионы - работают на CSS  
Слайдеры - jQuery / React slick  
Некоторые блоки написаны с помощью bemto (не пугаться)

## Работа с формами

Для подключения отправки в таблицу `Domoos_leads` нужно добавить элементу `form` класс `.js-lead-form`

- Поля `input` всех типов `hidden, text, tel, email, checkbox, select` принимают параметр `required`. При наличии этого параметра, необходимо заполнить это поле при отправке, иначе будет показываться ошибка

- Передача полей в запросе регулируется по имени поля. Например `input(name="city")` отправит параметр `city` в `options.values`. То есть параметры должны совпадать по имени. Все возможные параметры можно посмотреть в файле `app.js`, обьекте `formOptions` функции `validateSubmitHandler`. Параметров, которые не указаны в обьекте передаваться не будут (!)

- UTM метки передаются автоматически из `URL` - например `?utm_source=val&utm_medium=val&utm_campaign=val&utm_content=val&utm_term`. Обязательных параметров нет

- Параметр `date` генерируется автоматически в момент успешной отправки

- Допступные варианты валидации через html теги (`type`)

```js
required: 'Это поле необходимо заполнить.', // тег required
remote: 'Пожалуйста, введите правильное значение.', // валидация через запрос к API
email: 'Пожалуйста, введите корректный адрес электронной почты.', // type="email"
url: 'Пожалуйста, введите корректный URL.', // type="url"
date: 'Пожалуйста, введите корректную дату.', // type="date"
dateISO: 'Пожалуйста, введите корректную дату в формате ISO.', // type="dateISO"
number: 'Пожалуйста, введите число.', // type="number"
digits: 'Пожалуйста, вводите только цифры.', // type="digits"
// creditcard: 'Пожалуйста, введите правильный номер кредитной карты.', // тег creditcard - нужно подключение отдельного плагина
equalTo: 'Пожалуйста, введите такое же значение ещё раз.', // equalTo="xxx"
// extension: 'Пожалуйста, выберите файл с правильным расширением.', // extension="zip" - нужно подключение отдельного плагина
maxlength: $.validator.format('Пожалуйста, введите не больше {0} символов.'), // maxlength="10"
minlength: $.validator.format('Пожалуйста, введите не меньше {0} символов.'), // minlength="2"
rangelength: $.validator.format(
	'Пожалуйста, введите значение длиной от {0} до {1} символов.',
), // rangelength="[2, 6]"
range: $.validator.format('Пожалуйста, введите число от {0} до {1}.'), // range="[2,6]"
max: $.validator.format('Пожалуйста, введите число, меньшее или равное {0}.'), // max="10"
min: $.validator.format('Пожалуйста, введите число, большее или равное {0}.'), // min="2
```

# TODO

- [ ] Подключить pug автоформатер
- [ ] Настроить автодеплой проекта на сайт
- [x] Отрефакторить компонент CityExplorer, разделить его на саб-компоненты.
- [ ] Прописать статике хэши для кэширования.
- [ ] Заполнить мету в /head
- [ ] Микроформаты
- [ ] Перенести фейкодату из секций в json файлы расположенные в /data
